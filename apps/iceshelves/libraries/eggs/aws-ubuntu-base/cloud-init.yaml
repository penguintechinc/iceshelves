#cloud-config
# AWS EC2 Ubuntu 24.04 LTS Base
# Minimal cloud-init configuration for AWS EC2 instances

hostname: aws-ubuntu-base
timezone: UTC
locale: en_US.UTF-8

# Update packages on first boot
package_update: true
package_upgrade: true

# Install essential packages
packages:
  - vim
  - curl
  - wget
  - git
  - htop
  - awscli
  - python3-pip

# Create default user (ubuntu user is already created by AWS)
users:
  - name: ubuntu
    groups: sudo
    shell: /bin/bash
    sudo: ['ALL=(ALL) NOPASSWD:ALL']

# SSH configuration
ssh_pwauth: false
disable_root: true

# Write custom MOTD
write_files:
  - path: /etc/motd
    content: |
      ╔═══════════════════════════════════════════════════════════╗
      ║                                                           ║
      ║   🧊 Deployed with IceShelves - AWS EC2 Ubuntu Base       ║
      ║                                                           ║
      ║   Ubuntu 24.04 LTS on AWS EC2                            ║
      ║   Managed by: IceShelves Deployment Platform            ║
      ║                                                           ║
      ╚═══════════════════════════════════════════════════════════╝
    permissions: '0644'

# Run commands on first boot
runcmd:
  - echo "IceShelves deployment completed at $(date)" >> /var/log/iceshelves-deployment.log
  - systemctl enable ssh
  - systemctl start ssh

# Set up automatic security updates
apt:
  sources:
    ubuntu-security:
      source: "deb http://security.ubuntu.com/ubuntu noble-security main restricted universe multiverse"

final_message: "IceShelves AWS EC2 deployment completed successfully! Uptime: $UPTIME"
